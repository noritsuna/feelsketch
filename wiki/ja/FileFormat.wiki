#Feel Sketchのファイルフォーマットの仕様


= 全体 =
== エンディアン ==
* ビックエンディアン


== 拡張子 ==
* fs



= ヘッダ =
== バージョンID（version） ==
* 固定長：1byte(8bits)
* バージョン番号



== 画像サイズ（image size） ==
* 固定長：2byte
* ベースとなる画像のサイズ。
** 255をMaxとした相対値として、値を入れる。



== PM-Codeサイズ（PM-Code Size） ==
* 固定長：1byte
* PM-Codeの大きさを指定する。
** 用紙サイズの短辺に対して、1/n という意味。
*** 現在、固定的に『2』とする。



== PM-Code場所（PM-Code position） ==
* 固定長：1byte
* 用紙上、どこに印刷されているか？を示すコード。
** 要は、用紙を9分割した場合に、どこに印刷されているか？
||左上||1||
||左中央||2||
||左下||3||
||右上||4||
||右中央||5||
||右下||6||
||中央上||7||
||中央下||8||
||中央中央||9||



== 用紙サイズ（paper size） ==
* 固定長：1byte
* 印刷する用紙のサイズ。
** レターサイズやL判などをコードとして入れる。
||L判||1||
||Card||2||
||Post Card||3||
||A3||4||
||A4||5||
||B4||6||
||B5||7||



== 背景コード（backbround code） ==
* 固定長：1bytes
* 先頭ビットが、印刷するか？しないか？のフラグ
** 立っていれば、印刷する。
* 背景としては、『色』と『背景画像』が選択可能。
** 0は、背景なし。

=== 色 ===
||茶||1||#7C6035||
||赤||2||#CC0000||
||橙||3||#FFB74C||
||黄||4||#FFFF00||
||緑||5||#00FF41||
||青||6||#0C00CC||
||紫||7||#C400CC||
||灰||8||#8C8C8C||
||白||9||#FAFAFA||
||黒||10||#262626||
||肌色||11||#EAD2AD||
||ピンク||12||#F8ABA6||


=== 背景画像 ===
* ※現在、捜索中



== 予約（reserved） ==
* 固定長：1byte



== UUID（UUID） ==
* 固定長：16bytes(128bits)
* 作られた本画像を唯一無二のモノとして認識するためのID。
** マーカーの代わりとして使用したりすることが出来る。これとメディアデータを併せることにより、統計情報を取得することも可能。



== メディアデータ（media data） ==
* 可変長：終端コード: \r\n(CR LF) が出るまで
** 例：mail:xxx@pmcode.jp のような形で、外部情報へのポインタを示す。
*** 利用例としては、この画像を描いた店員のメールアドレスを付加するなど。そうすることにより、店員と顧客とを結ぶ導線を作ることが出来る。



= コマンド =
== コマンド種類（command types） ==
* 固定長：1bytes
* 線やアイコンなどを示すコード。
||レイヤー(layer)||0||
||アイコン(icon)||1||
||直線(line)||2||
||ベジェ曲線(Bezier curve)||3||
||スプライン曲線(spline curve)||4||
||文字(letter)||5||
||図形(shape)||6||
||終端(terminal)||255||



== エフェクト（effect） ==
* 固定長：2bytes
* エフェクトの種類を表すコード。
** これは、ビットで表現し、重ねがけが出来るようにする。
||点滅||0b0000000000000001||
||振動||0b0000000000000010||
||移動||0b0000000000000100||
||フェードイン||0b0000000000001000||
||フェードアウト||0b0000000000010000||



== 色（color code） ==
* 固定長：1byte
* 色を表すコード。
** 固定的に色を表す。
||透明||0||なし||
||茶||1||#7C6035||
||赤||2||#CC0000||
||橙||3||#FFB74C||
||黄||4||#FFFF00||
||緑||5||#00FF41||
||青||6||#0C00CC||
||紫||7||#C400CC||
||灰||8||#8C8C8C||
||白||9||#FAFAFA||
||黒||10||#262626||
||肌色||11||#EAD2AD||
||ピンク||12||#F8ABA6||



== 点（point） ==
* 固定長：2bytes
* 1～254 までで表されるXYの座標。
** (x,y)の順で示される。



== アイコンID（icon ID） ==
* 固定長：2bytes
* アイコンのID番号。



== レイヤー順位（layer position） ==
* 固定長：1bytes
* 先頭ビットは、PM-Code化するか？しないか？を示す。



== 線の種類（line type） ==
* 固定長：1bytes
* 実質的には、ペンの種類を表すコード。
** pixelは、ベースサイズ(255)に合わせたpixel数。
||名称||コード||pixel数||
||細い線||1||1||
||中サイズの線||2||3||
||太い線||3||6||
||極太線||4||10||
||細い蛍光ペン||5||3||
||中サイズの蛍光ペン||6||6||
||太い蛍光ペン||7||10||



== 文字の種類（letter type） ==
* 固定長：1bytes
* フォントの種類の指定。



== 文字サイズ（letter size） ==
* 固定長：1bytes
* フォントサイズ。




= 構造 =
== ヘッダ ==
{{{
|Version|画像サイズ|PM-Codeサイズ|PM-Code場所|用紙サイズ|背景コード|UUID|Reserved|
}}}



== 直線(line) ==
{{{
|コマンド種類(直線)|線の種類|色|点1-xy|点2-xy|
}}}



== 直線続き(line next) ==
{{{
|点2-xy| ・・・・ |{終端}|
}}}

* 直線の直後にしか出てこない。
** 「|点1-xy|」は、直前の「|点2-xy|」を利用する。



== ベジェ曲線(Bezier curve) ==
{{{
|コマンド種類(ベジェ曲線)|線の種類|色|点1-xy|点2-xy|点3-xy|点4-xy|
}}}



== ベジェ曲線続き(Bezier curve next) ==
{{{
|点2-xy|点3-xy|点4-xy| ・・・・ |{終端}|
}}}

* ベジェ曲線の直後にしか出てこない。
** 「|点1-xy|」は、直前の「|点4-xy|」を利用する。


== スプライン曲線(spline curve) ==
{{{
|コマンド種類(スプライン曲線)|線の種類|色|点1-xy|点2-xy|点3-xy|
}}}


== スプライン曲線続き(spline curve next) ==
{{{
|点2-xy|点3-xy| ・・・・ |{終端}|
}}}

* スプライン曲線の直後にしか出てこない。
** 「|点1-xy|」は、直前の「|点3-xy|」を利用する。



== アイコン(icon) ==
{{{
|コマンド種類(アイコン)|点1-xy|ID|{終端}|
}}}

*「|点1-xy|」は、中心点。


== 文字(letter) ==
{{{
|コマンド種類(文字)|文字の種類|文字サイズ|色|点1-xy|UTF-8コード|{終端}|
}}}

* 「|点1-xy|」は、一文字目の左上。



== 図形(shape) ==
{{{
|コマンド種類(図形)|線の種類|色|点1-xy|ID|{終端}|
}}}

* 円や星形など、直線や曲線の組み合わせで描かれる組み込みのテンプレート図形。
*「|点1-xy|」は、始点。



== レイヤー(layer) ==
{{{
|コマンド種類(レイヤー)|レイヤー順位|エフェクト|{線}|{線}|{アイコン}|・・・
}}}


* すべてのコマンド(線やアイコン)は、必ず、レイヤーの一部として含まれる。
* レイヤーに終端(teiminal)は付けない。



== 終端(teiminal) ==
{{{
|コマンド種類(終端)|数値：255|
}}}

* 要は、コマンド種類(終端)が、2個連続したら終端と見なす。
* レイヤー以外のコマンドには、必須。



= ヘッダー構造 =
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   version     |          image size           | PM-Code size  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  PM-Code pos  |  paper size   |background code|   reserved    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                              UUID                             |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                          media data                           |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        \r\n(CR LF)            |           body                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              body                             |
   |                              body                             |
   |                              body                             |
}}}


= ボディー構造 =
== 直線(line) ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 2   |  line type    |  color code   |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               | command : 255 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     255       |
   +-+-+-+-+-+-+-+-+
}}}


== 直線(line) の 2本以上連続したモノ ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 2   |  line type    |  color code   |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               | command : 255 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     255       |
   +-+-+-+-+-+-+-+-+
}}}


== ベジェ曲線(Bezier curve) ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 3   |  line type    |  color code   |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      | command : 255 |     255       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
}}}


== ベジェ曲線(Bezier curve) の 連続したモノ ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 3   |  line type    |  color code   |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      | command : 255 |     255       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
}}}


== スプライン曲線(spline curve) ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 4   |  line type    |  color code   |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      | command : 255 |     255       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
}}}


== スプライン曲線(spline curve)  の 連続したモノ ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 4   |  line type    |  color code   |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      |           point               |    point       
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        point      | command : 255 |     255       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
}}}


== アイコン ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 1   |           point              |     icon id     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       icon id     | command : 255 |      255     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
}}}


== 文字 ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 0   |  layer pos    |           effect              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 5   |  letter type  |  letter size  |  color code   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            point              | UTF-8 code    |  UTF-8 code   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 255 |     255       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
}}}


== 終端 ==
{{{
    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | command : 255 |     255       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
}}}

